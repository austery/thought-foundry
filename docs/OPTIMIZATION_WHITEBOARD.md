# Eleventy ä¼˜åŒ–ç™½æ¿ - æˆ˜ç•¥æ€è€ƒä¸ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**æ—¥æœŸ**: 2025-12-05  
**å½“å‰çŠ¶æ€**: Phase 3 å®Œæˆï¼Œéœ€è¦æˆ˜ç•¥å†³ç­–

---

## ğŸ“Š å½“å‰æ€§èƒ½å¿«ç…§

### Phase 3 æœ€ç»ˆç»“æœ
```
âœ¨ æ„å»ºæ—¶é—´: 80 ç§’
ğŸš€ Slug è°ƒç”¨: 511,244 æ¬¡
ğŸ“ˆ ç¼“å­˜å‘½ä¸­ç‡: 91.1% (465,786 hits / 45,458 misses)
ğŸ“„ ç”Ÿæˆæ–‡ä»¶: 35,887 ä¸ª
ğŸ” ç´¢å¼•é¡µé¢: 3,240 ä¸ª
```

### ä¼˜åŒ–å†ç¨‹å¯¹æ¯”

| é˜¶æ®µ | æ„å»ºæ—¶é—´ | Slugè°ƒç”¨ | ç¼“å­˜å‘½ä¸­ç‡ | ä¸»è¦æ”¹åŠ¨ |
|------|---------|---------|-----------|---------|
| **Baseline** | ~3å°æ—¶ | æœªçŸ¥ | æœªçŸ¥ | åŸå§‹ä»£ç  |
| **Phase 1** | æœªæµ‹ | æœªçŸ¥ | æœªçŸ¥ | Gemini åˆæ­¥ä¼˜åŒ– |
| **Phase 2** | 74ç§’ | 585,279 | 92.2% | é›†åˆé¢„è®¡ç®— slug |
| **Phase 3** | 80ç§’ | 511,244 | 91.1% | æ¨¡æ¿ä½¿ç”¨ helper filters |

---

## ğŸ¯ å…³é”®å‘ç°

### âœ… æˆåŠŸçš„ä¼˜åŒ–

1. **Regex é¢„ç¼–è¯‘** - é¿å…åˆ›å»º 465,000+ æ­£åˆ™å¯¹è±¡
2. **Pinyin ç¼“å­˜æŒä¹…åŒ–** - 100% å‘½ä¸­ç‡ï¼Œ45,999 æ¡ç›®
3. **Slug ç¼“å­˜ç³»ç»Ÿ** - 91% å‘½ä¸­ç‡
4. **é›†åˆé¢„è®¡ç®—** - æ‰€æœ‰ 9 ä¸ªé›†åˆéƒ½æœ‰ `slug` å±æ€§
5. **Helper Filters** - 9 ä¸ªè¾…åŠ©è¿‡æ»¤å™¨ç®€åŒ–æ¨¡æ¿ä»£ç 

### âš ï¸ æ€§èƒ½ç“¶é¢ˆåˆ†æ

#### Phase 3 çš„"åç›´è§‰"ç»“æœ
- **é¢„æœŸ**: å‡å°‘ slug è®¡ç®— â†’ æ›´å¿«æ„å»º
- **å®é™…**: å‡å°‘ 74k æ¬¡è°ƒç”¨ â†’ **æ…¢äº† 6 ç§’**
- **åŸå› **: Collection `.find()` æŸ¥æ‰¾å¼€é”€è¶…è¿‡äº†èŠ‚çœçš„ slug è®¡ç®—æ—¶é—´

#### Benchmark æ•°æ®è§£è¯»
```
Phase 2: Slug filter è€—æ—¶ 11.7ç§’ (1.5% of 74s)
Phase 3: Slug filter è€—æ—¶ 17.2ç§’ (21% of 80s)
```
**çŸ›ç›¾ç‚¹**: Slug è°ƒç”¨å‡å°‘äº†ï¼Œä½† benchmark æ—¶é—´åè€Œå¢åŠ ï¼Ÿ
- **å¯èƒ½åŸå›  1**: Helper filters çš„ `.find()` è¢«è®¡å…¥ slug filter æ—¶é—´
- **å¯èƒ½åŸå›  2**: å¤šæ¬¡æŸ¥æ‰¾åŒä¸€å®ä½“ï¼ˆæ¯ä¸ªæ¨¡æ¿æ¸²æŸ“éƒ½æŸ¥ä¸€æ¬¡ï¼‰
- **å¯èƒ½åŸå›  3**: Nunjucks çš„ filter è°ƒç”¨é“¾å¼€é”€

---

## ğŸ”¬ é—®é¢˜è¯Šæ–­ï¼šä¸ºä»€ä¹ˆæ…¢äº†ï¼Ÿ

### é—®é¢˜æ¨¡å¼åˆ†æ

**å½“å‰å®ç°ï¼ˆPhase 3ï¼‰**:
```javascript
// .eleventy.js - Helper filter
getSpeakerSlug(name, collections) {
  const uniqueKey = getSpeakerUniqueKey(name, collections);  // è®¡ç®—1
  const speaker = collections.speakerList.find(s => s.uniqueKey === uniqueKey);  // O(n) æŸ¥æ‰¾
  return speaker ? speaker.slug : slug(uniqueKey);  // å¯èƒ½å†æ¬¡è®¡ç®—
}
```

**è°ƒç”¨é¢‘ç‡ï¼ˆä¼°ç®—ï¼‰**:
- `blog.njk`: 3,240 posts Ã— 1 speaker = 3,240 æ¬¡æŸ¥æ‰¾
- `post.njk`: 3,240 posts Ã— (speaker + guest + area + category + 3 projects + 5 entities) = ~40k æ¬¡æŸ¥æ‰¾
- å…¶ä»–é¡µé¢: ~10k æ¬¡æŸ¥æ‰¾
- **æ€»è®¡**: ~50,000 æ¬¡ `.find()` æ“ä½œ

**é—®é¢˜æ ¹æº**:
```
O(1) slug cache lookup â†’ æ›¿æ¢ä¸º â†’ O(n) collection.find()
å•æ¬¡å¿«é€ŸæŸ¥æ‰¾ â†’ å¤šæ¬¡çº¿æ€§æœç´¢
```

---

## ğŸ’¡ ä¸‹ä¸€æ­¥ä¼˜åŒ–ç­–ç•¥ï¼ˆå¾…å†³ç­–ï¼‰

### é€‰é¡¹ A: å›æ»šåˆ° Phase 2 ã€ä¿å®ˆæ´¾ã€‘
**ç†ç”±**: Phase 2 å·²ç»å¾ˆå¿«ï¼ˆ74ç§’ï¼‰ï¼Œä»£ç ç®€å•
```
- ç§»é™¤ 9 ä¸ª helper filters
- æ¢å¤æ¨¡æ¿ä¸­çš„ `| slug` è°ƒç”¨
- ä¿ç•™é›†åˆä¸­çš„é¢„è®¡ç®— `slug`ï¼ˆä¸å½±å“æ€§èƒ½ï¼‰
```
**ä¼˜ç‚¹**: 
- âœ… ç«‹å³æ¢å¤åˆ° 74 ç§’
- âœ… ä»£ç æ›´ç®€å•
- âœ… ç¼“å­˜å‘½ä¸­ç‡æ›´é«˜ï¼ˆ92.2%ï¼‰

**ç¼ºç‚¹**:
- âŒ æ¨¡æ¿ä¸­ä»æœ‰ 74k æ¬¡"å¤šä½™"slug è°ƒç”¨
- âŒ æœªå……åˆ†åˆ©ç”¨é¢„è®¡ç®—çš„ slug

---

### é€‰é¡¹ B: ä¼˜åŒ– Helper Filters ã€æ¿€è¿›æ´¾ã€‘
**ç†ç”±**: Collection æŸ¥æ‰¾å¯ä»¥ä¼˜åŒ–åˆ°æ¥è¿‘ O(1)

#### B1. æ·»åŠ  Slug Map ç¼“å­˜
```javascript
// æ„å»ºæ—¶åˆ›å»ºæŸ¥æ‰¾è¡¨
const speakerSlugMap = new Map();
collections.speakerList.forEach(s => {
  speakerSlugMap.set(s.uniqueKey, s.slug);
  speakerSlugMap.set(s.key, s.slug);
  speakerSlugMap.set(s.name.toLowerCase(), s.slug);
});

// Helper filter å˜ä¸º O(1)
getSpeakerSlug(name, collections) {
  const key = name.toLowerCase().trim();
  return speakerSlugMap.get(key) || slug(name);
}
```

**ä¼˜ç‚¹**:
- âœ… O(n) â†’ O(1) æŸ¥æ‰¾
- âœ… ä¿ç•™å¹²å‡€çš„æ¨¡æ¿ä»£ç 
- âœ… å¯èƒ½æ¯” Phase 2 æ›´å¿«

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦ä¸ºæ¯ä¸ªé›†åˆåˆ›å»º Map
- âš ï¸ å†…å­˜å ç”¨å¢åŠ ï¼ˆ9ä¸ª Maps Ã— ~5,000 entitiesï¼‰

#### B2. å»¶è¿Ÿè®¡ç®— + è®°å¿†åŒ–
```javascript
const slugMemo = new Map();
getSpeakerSlug(name, collections) {
  if (slugMemo.has(name)) return slugMemo.get(name);
  
  const result = /* æŸ¥æ‰¾é€»è¾‘ */;
  slugMemo.set(name, result);
  return result;
}
```

---

### é€‰é¡¹ C: æ··åˆæ–¹æ¡ˆ ã€å®ç”¨æ´¾ã€‘
**ç†ç”±**: é’ˆå¯¹é«˜é¢‘åœºæ™¯ä¼˜åŒ–ï¼Œä½é¢‘åœºæ™¯ç”¨ç®€å•æ–¹æ¡ˆ

#### C1. åªä¼˜åŒ–é«˜é¢‘æ¨¡æ¿
- **blog.njk** (3,240Ã—) â†’ ä½¿ç”¨ helper filter
- **post.njk** (3,240Ã—) â†’ ç›´æ¥ä» item.data è¯»å–ï¼ˆæ— éœ€æŸ¥æ‰¾ï¼‰
- **å…¶ä»–æ¨¡æ¿** â†’ ç”¨ `| slug` ï¼ˆç®€å•å¿«é€Ÿï¼‰

#### C2. é¢„è®¡ç®— + ç¼“å­˜åˆ° Frontmatter
åœ¨é›†åˆå¤„ç†æ—¶ï¼š
```javascript
// ä¸ºæ¯ä¸ª post æ·»åŠ é¢„è®¡ç®—çš„ slugs
item.data._slugs = {
  speaker: getSpeakerSlug(item.data.speaker),
  area: getAreaSlug(item.data.area),
  // ...
};
```

æ¨¡æ¿ç›´æ¥è¯»å–ï¼š
```nunjucks
<a href="/speakers/{{ item.data._slugs.speaker }}/">
```

---

## ğŸ¤” æˆ˜ç•¥å†³ç­–ç‚¹

### é—®é¢˜ 1: æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ
- [ ] **A. æœ€å¿«æ„å»ºé€Ÿåº¦** â†’ é€‰é¡¹ Aï¼ˆå›æ»šï¼‰æˆ– B1ï¼ˆMap ç¼“å­˜ï¼‰
- [ ] **B. æœ€å¹²å‡€ä»£ç ** â†’ é€‰é¡¹ Bï¼ˆä¼˜åŒ– helpersï¼‰æˆ– C2ï¼ˆé¢„è®¡ç®—ï¼‰
- [ ] **C. å¹³è¡¡æ€§èƒ½ä¸å¯ç»´æŠ¤æ€§** â†’ é€‰é¡¹ Cï¼ˆæ··åˆï¼‰

### é—®é¢˜ 2: 80ç§’ vs 74ç§’ æ˜¯å¦å¯æ¥å—ï¼Ÿ
- [ ] **å¯æ¥å—** â†’ ä¿æŒ Phase 3ï¼Œè¿›å…¥ Phase 4ï¼ˆå…¶ä»–ä¼˜åŒ–ï¼‰
- [ ] **ä¸å¯æ¥å—** â†’ å›æ»šæˆ–ä¼˜åŒ–

### é—®é¢˜ 3: å€¼å¾—ç»§ç»­ä¼˜åŒ–å—ï¼Ÿ
**å½“å‰ç“¶é¢ˆ**:
```
æ€»æ„å»ºæ—¶é—´: 80ç§’
- Eleventy: 54ç§’ (68%)
- Pagefind: 26ç§’ (32%)
```

**Slug filter åªå  21%** (17ç§’)ï¼Œè¿˜æœ‰å…¶ä»–æ›´å¤§çš„ç“¶é¢ˆï¼š
- URL filter: 11% (8.9ç§’)
- File I/O: æœªçŸ¥
- Markdown æ¸²æŸ“: æœªçŸ¥
- Template æ¸²æŸ“: æœªçŸ¥

---

## ğŸ“‹ Phase 4 å€™é€‰ä¼˜åŒ–é¡¹ï¼ˆå¦‚æœç»§ç»­ï¼‰

### 1. Pagination ä¼˜åŒ–
**é—®é¢˜**: `blog.njk` æ¸²æŸ“ 3,240 ä¸ª posts åœ¨ä¸€ä¸ªé¡µé¢
**æ–¹æ¡ˆ**: åˆ†é¡µ (100 posts/page) â†’ 33 é¡µ
**é¢„æœŸ**: å‡å°‘å•é¡µæ¸²æŸ“æ—¶é—´

### 2. Incremental Build
**é—®é¢˜**: æ¯æ¬¡éƒ½å…¨é‡æ„å»º
**æ–¹æ¡ˆ**: åªé‡å»ºä¿®æ”¹çš„æ–‡ä»¶
**é¢„æœŸ**: å¼€å‘æ—¶ 2-5 ç§’æ„å»º

### 3. Parallel Processing
**é—®é¢˜**: å•çº¿ç¨‹æ„å»º
**æ–¹æ¡ˆ**: Worker threads å¹¶è¡Œå¤„ç†
**é¢„æœŸ**: ç†è®ºä¸Š 2-4Ã— åŠ é€Ÿ

### 4. Pagefind ä¼˜åŒ–
**é—®é¢˜**: ç´¢å¼•è€—æ—¶ 26 ç§’
**æ–¹æ¡ˆ**: 
- å‡å°‘ç´¢å¼•å­—æ®µ
- ä½¿ç”¨ Pagefind çš„å¢é‡ç´¢å¼•
**é¢„æœŸ**: å‡å°‘ 50% ç´¢å¼•æ—¶é—´

### 5. Template ç¼“å­˜
**é—®é¢˜**: ç›¸åŒæ¨¡æ¿é‡å¤ç¼–è¯‘
**æ–¹æ¡ˆ**: Nunjucks æ¨¡æ¿é¢„ç¼–è¯‘
**é¢„æœŸ**: å‡å°‘æ¨¡æ¿è§£ææ—¶é—´

---

## ğŸ¬ æ¨èè¡ŒåŠ¨æ–¹æ¡ˆ

### ç«‹å³è¡ŒåŠ¨ï¼ˆä»Šå¤©ï¼‰

#### æ–¹æ¡ˆ 1: å¿«é€ŸéªŒè¯ã€æ¨èã€‘
```bash
# 1. å›æ»šåˆ° Phase 2 éªŒè¯æ€§èƒ½
git stash  # ä¿å­˜ Phase 3 æ”¹åŠ¨
npm run build  # æµ‹è¯• Phase 2 æ€§èƒ½

# 2. å¦‚æœç¡®å®æ˜¯ 74ç§’
# é€‰æ‹©: ä¿æŒ Phase 2 or å®æ–½ Option B1ï¼ˆMap ç¼“å­˜ï¼‰
```

#### æ–¹æ¡ˆ 2: æ·±åº¦åˆ†æ
```bash
# ä½¿ç”¨ Node profiler æ‰¾å‡ºçœŸæ­£ç“¶é¢ˆ
node --prof node_modules/.bin/eleventy
node --prof-process isolate-*.log > profile.txt
# åˆ†æ profile.txt æ‰¾å‡ºæœ€è€—æ—¶çš„å‡½æ•°
```

#### æ–¹æ¡ˆ 3: A/B æµ‹è¯•
```bash
# åˆ›å»º benchmark è„šæœ¬
for i in {1..5}; do
  time npm run build > /dev/null
done
# å¯¹æ¯” Phase 2 vs Phase 3 vs Option B1
```

---

### çŸ­æœŸè®¡åˆ’ï¼ˆæœ¬å‘¨ï¼‰

1. **å†³ç­–**: é€‰æ‹© Option A/B/C
2. **å®æ–½**: æ ¹æ®é€‰æ‹©å®æ–½å¯¹åº”æ–¹æ¡ˆ
3. **éªŒè¯**: æµ‹è¯•æ„å»ºæ—¶é—´å’ŒåŠŸèƒ½æ­£ç¡®æ€§
4. **æ–‡æ¡£**: æ›´æ–°ä¼˜åŒ–æ—¥å¿—

### é•¿æœŸè®¡åˆ’ï¼ˆæœ¬æœˆï¼‰

1. **Phase 4**: å®æ–½å…¶ä»–é«˜ä»·å€¼ä¼˜åŒ–ï¼ˆPagination/Incrementalï¼‰
2. **ç›‘æ§**: å»ºç«‹æ„å»ºæ—¶é—´ç›‘æ§
3. **è‡ªåŠ¨åŒ–**: CI/CD é›†æˆæ€§èƒ½æµ‹è¯•

---

## ğŸ“š æŠ€æœ¯å€ºåŠ¡è®°å½•

### å¾…ä¼˜åŒ–é¡¹
1. [ ] å†³å®š Phase 3 å»ç•™
2. [ ] å¦‚æœä¿ç•™ï¼Œå®æ–½ Map ç¼“å­˜ä¼˜åŒ–
3. [ ] æ·»åŠ æ„å»ºæ€§èƒ½ç›‘æ§
4. [ ] è€ƒè™‘ incremental build

### å·²çŸ¥é—®é¢˜
1. âš ï¸ Helper filters æœ‰æ€§èƒ½å¼€é”€
2. âš ï¸ Collection.find() æ˜¯ O(n) æ“ä½œ
3. âš ï¸ æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°æŸ¥æ‰¾ï¼ˆæ— è®°å¿†åŒ–ï¼‰

### æŠ€æœ¯é€‰å‹åæ€
- **Nunjucks**: åŠŸèƒ½å¼ºå¤§ä½†æ— æ³•ä½¿ç”¨ç°ä»£ JS è¯­æ³•ï¼ˆç®­å¤´å‡½æ•°ï¼‰
- **Eleventy Collections**: ç®€å•ä½†ä¸æ”¯æŒç´¢å¼•æŸ¥æ‰¾
- **Slug System**: å·¥ä½œè‰¯å¥½ï¼Œä½†ä¸ collection æŸ¥æ‰¾ç»“åˆåå˜æ…¢

---

## ğŸ§ª å®éªŒè®°å½•

### å®éªŒ 1: Phase 2 â†’ Phase 3
- **å‡è®¾**: å‡å°‘ slug è®¡ç®— â†’ æ›´å¿«æ„å»º
- **ç»“æœ**: âŒ æ…¢äº† 6 ç§’
- **åŸå› **: Collection æŸ¥æ‰¾å¼€é”€ > Slug è®¡ç®—èŠ‚çœ
- **å­¦ä¹ **: O(1) ç¼“å­˜ > O(n) æŸ¥æ‰¾

### å®éªŒ 2: Helper Filters
- **å‡è®¾**: å°è£…æŸ¥æ‰¾é€»è¾‘ â†’ æ›´å¹²å‡€ä»£ç 
- **ç»“æœ**: âœ… ä»£ç æ›´ç®€æ´ï¼Œä½† âŒ æ€§èƒ½å˜å·®
- **å­¦ä¹ **: æŠ½è±¡æœ‰ä»£ä»·ï¼Œéœ€è¦ä¼˜åŒ–åº•å±‚å®ç°

---

## ğŸ’¬ è®¨è®ºç¬”è®°

### Claude çš„å»ºè®®
- âœ… ä¿ç•™ DEBUG æ—¥å¿—ï¼ˆå†²çªæ£€æµ‹ï¼‰
- âœ… ä½¿ç”¨é¢„è®¡ç®— slug
- âš ï¸ æé†’æ³¨æ„å¯è§‚æµ‹æ€§ > æ€§èƒ½

### Gemini çš„å»ºè®®
- âœ… Regex é¢„ç¼–è¯‘
- âœ… é›†åˆä¼˜åŒ–
- âœ… ç¼“å­˜ç³»ç»Ÿ

### ä½ çš„åé¦ˆ
- æƒ³çœ‹åˆ°ä¼˜åŒ–æ•ˆæœ
- å…³æ³¨æ„å»ºé€Ÿåº¦
- éœ€è¦æƒè¡¡æ€§èƒ½ vs ä»£ç è´¨é‡

---

## ğŸ”® ä¸‹ä¸€æ­¥å†³ç­–æ ‘

```
ç°åœ¨çš„ä½ç½®: Phase 3 å®Œæˆï¼Œæ„å»º 80ç§’
                    |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   80ç§’å¯æ¥å—ï¼Ÿ              ä¸å¯æ¥å—
        â”‚                       â”‚
        â†“                       â†“
   è¿›å…¥ Phase 4           éœ€è¦ä¼˜åŒ–
    (å…¶ä»–ä¼˜åŒ–)               |
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
               å›æ»š Phase 3      ä¼˜åŒ– Helpers
                  (74ç§’)           (Mapç¼“å­˜)
                    â”‚                 â”‚
                    â†“                 â†“
                ä¿æŒç®€å•          è¿½æ±‚æè‡´
```

---

## âœ… è¡ŒåŠ¨æ£€æŸ¥æ¸…å•

### ä»Šå¤©å¿…é¡»å†³å®š
- [ ] 80ç§’æ˜¯å¦å¯æ¥å—ï¼Ÿ
- [ ] é€‰æ‹© Option A/B/Cï¼Ÿ
- [ ] éœ€è¦ profiling å—ï¼Ÿ

### æœ¬å‘¨å®Œæˆ
- [ ] å®æ–½é€‰å®šæ–¹æ¡ˆ
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆ3æ¬¡å–å¹³å‡ï¼‰
- [ ] æ›´æ–°æ–‡æ¡£

### é•¿æœŸè·Ÿè¸ª
- [ ] å»ºç«‹æ€§èƒ½åŸºå‡†
- [ ] CI é›†æˆ
- [ ] ç›‘æ§æ„å»ºè¶‹åŠ¿

---

**æœ€åæ›´æ–°**: 2025-12-05 15:42 UTC  
**ä¸‹æ¬¡å®¡æŸ¥**: å¾…å®š  
**è´£ä»»äºº**: Lei Peng
