---
layout: "base.njk"
---

<div class="report-container">
    
  <aside id="toc-container" class="sidebar-toc"></aside>
  
  <main id="content-body" class="main-content" data-page-title="{{ title }}">
    
    <div id="top"></div>
    
    {# ------------------- 新增的元数据块代码开始 ------------------- #}

    <div class="metadata-block">
      {# 使用 if 判断，只有当数据存在时才显示这一行 #}
      {% if speaker %}
        <p><strong>主讲人:</strong> 
          {# 处理多个演讲者的情况，用逗号分隔 #}
          {% set speakers = speaker.split(',') %}
          {% for speakerName in speakers %}
            {% set trimmedSpeaker = speakerName.trim() %}
            {% if trimmedSpeaker != '' %}
              {% set speakerUniqueKey = trimmedSpeaker | getSpeakerUniqueKey(collections) %}
              <a class="speaker-link" href="{{ ('/speakers/' + (speakerUniqueKey | slug) + '/') | url }}">{{ trimmedSpeaker }}</a>{% if not loop.last %}, {% endif %}
            {% endif %}
          {% endfor %}
        </p>
      {% endif %}

      {% if guest %}
        <p><strong>嘉宾:</strong> 
          {# 处理多个嘉宾的情况，用逗号分隔 #}
          {% set guests = guest.split(',') %}
          {% for guestName in guests %}
            {% set trimmedGuest = guestName.trim() %}
            {% if trimmedGuest != '' %}
              {% set guestUniqueKey = trimmedGuest | getSpeakerUniqueKey(collections) %}
              <a class="speaker-link" href="{{ ('/speakers/' + (guestUniqueKey | slug) + '/') | url }}">{{ trimmedGuest }}</a>{% if not loop.last %}, {% endif %}
            {% endif %}
          {% endfor %}
        </p>
      {% endif %}

      {% if source %}
        <p><strong>来源:</strong> <a href="{{ source }}" target="_blank">查看</a></p>
      {% endif %}

      {% if channel %}
        <p><strong>频道:</strong> {{ channel }}</p>
      {% endif %}
      
      {# 摘要部分 #}
      {% if summary %}
        <div class="summary-section">
          <p><strong>摘要:</strong></p>
          <div class="summary-content">{{ summary }}</div>
        </div>
      {% endif %}
      
      {# 洞察部分 #}
      {% if insight %}
        <div class="insight-section">
          <p><strong>洞察:</strong></p>
          <div class="insight-content">{{ insight }}</div>
        </div>
      {% endif %}
      
      {# 关键字部分，我们直接遍历这篇文章的 tags #}
      {% if tags %}
        <p><strong>关键字:</strong> 
          {% for tag in tags %}
            <a class="tag-link" href="{{ ('/tags/' + (tag | slug) + '/') | url }}">{{ tag }}</a>
          {% endfor %}
        </p>
      {% endif %}
    </div>

    {# ------------------- 新增的元数据块代码结束 ------------------- #}

    {{ content | safe }}

    {# ------------------- 系列相关文章开始 ------------------- #}
    {% if series and series.trim() != '' %}
      {% set relatedPosts = collections.allItems | filterExcluded %}
      {% set sameSeries = [] %}
      
      {# 找到同一系列的其他文章 #}
      {% for post in relatedPosts %}
        {% if post.data.series and post.data.series.trim() == series.trim() and post.url != page.url %}
          {% set sameSeries = (sameSeries.push(post), sameSeries) %}
        {% endif %}
      {% endfor %}

      {# 如果有同系列的文章，显示相关文章区块 #}
      {% if sameSeries.length > 0 %}
        <div class="related-series">
          <h3>本系列其他文章</h3>
          <p class="series-name">系列：{{ series }}</p>
          <ul class="related-posts-list">
            {% for post in sameSeries | sort(false, false, 'date') %}
              <li class="related-post-item">
                <a href="{{ post.url }}" class="related-post-link">
                  <span class="related-post-title">{{ post.data.title }}</span>
                  {% if post.data.date %}
                    <span class="related-post-date">{{ post.data.date }}</span>
                  {% endif %}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    {% endif %}
    {# ------------------- 系列相关文章结束 ------------------- #}
  </main>

</div>

<script src="{{ '/js/post.js' | url }}"></script>