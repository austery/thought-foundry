---
layout: "base.njk"
---

<div class="report-container">
    
  <aside id="toc-container" class="sidebar-toc"></aside>
  
  <main id="content-body" class="main-content" data-page-title="{{ title }}">
    
    <div id="top"></div>
    
    {# ------------------- 元数据块代码开始 ------------------- #}

    <div class="metadata-block">
      {# PKM 分类法 (v7.4) - 显示在最顶部 #}
      {% if area or category or (project and project.length > 0) %}
        <div class="pkm-taxonomy">
          {% if area %}
            <p><strong>领域:</strong> <span class="taxonomy-value">{{ area }}</span></p>
          {% endif %}
          {% if category %}
            <p><strong>分类:</strong>
              <a class="taxonomy-link" href="{{ ('/categories/' + (category | slug) + '/') | url }}">{{ category }}</a>
            </p>
          {% endif %}
          {% if project and project.length > 0 %}
            <p><strong>专题:</strong>
              {% for proj in project %}
                <a class="taxonomy-link" href="{{ ('/projects/' + (proj | slug) + '/') | url }}">{{ proj }}</a>{% if not loop.last %}, {% endif %}
              {% endfor %}
            </p>
          {% endif %}
        </div>
      {% endif %}

      {# 第一部分：主讲人和来源信息 #}
      {% if speaker %}
        <p><strong>主讲人:</strong>
          {# 处理多个演讲者的情况，用逗号分隔 #}
          {% set speakers = speaker.split(',') %}
          {% for speakerName in speakers %}
            {% set trimmedSpeaker = speakerName.trim() %}
            {% if trimmedSpeaker != '' %}
              {% set speakerUniqueKey = trimmedSpeaker | getSpeakerUniqueKey(collections) %}
              <a class="speaker-link" href="{{ ('/speakers/' + (speakerUniqueKey | slug) + '/') | url }}">{{ trimmedSpeaker }}</a>{% if not loop.last %}, {% endif %}
            {% endif %}
          {% endfor %}
        </p>
      {% endif %}

      {% if guest %}
        <p><strong>嘉宾:</strong>
          {# 处理多个嘉宾的情况，用逗号分隔 #}
          {% set guests = guest.split(',') %}
          {% for guestName in guests %}
            {% set trimmedGuest = guestName.trim() %}
            {% if trimmedGuest != '' %}
              {% set guestUniqueKey = trimmedGuest | getSpeakerUniqueKey(collections) %}
              <a class="speaker-link" href="{{ ('/speakers/' + (guestUniqueKey | slug) + '/') | url }}">{{ trimmedGuest }}</a>{% if not loop.last %}, {% endif %}
            {% endif %}
          {% endfor %}
        </p>
      {% endif %}

      {% if source %}
        <p><strong>来源:</strong> <a href="{{ source }}" target="_blank">查看</a></p>
      {% endif %}

      {% if channel %}
        <p><strong>频道:</strong> {{ channel }}</p>
      {% endif %}

      {# 第二部分：发布时间 #}
      {% if date %}
        <p><strong>发布时间:</strong>
          {% if date.toLocaleDateString %}
            {{ date.toLocaleDateString() }}
          {% else %}
            {{ date }}
          {% endif %}
        </p>
      {% endif %}

      {# 第三部分：摘要和关键字 #}
      {# 摘要部分 #}
      {% if summary %}
        <div class="summary-section">
          <p><strong>摘要:</strong></p>
          <div class="summary-content">{{ summary }}</div>
        </div>
      {% endif %}

      {# 洞察部分 #}
      {% if insight %}
        <div class="insight-section">
          <p><strong>洞察:</strong></p>
          <div class="insight-content">{{ insight }}</div>
        </div>
      {% endif %}
    </div>

    {# ------------------- 元数据块代码结束 ------------------- #}

    {{ content | safe }}

    {# ------------------- 文章末尾元数据开始 ------------------- #}

    {# 实体提取信息 (v7.4) - 使用可折叠区域 #}
    {% if people or companies_orgs or products_models or media_books %}
      <div class="entity-section">
        <details>
          <summary>📌 文中提及的人物和组织</summary>
          <div class="entity-content">
            {% if people and people.length > 0 %}
              <p><strong>人物:</strong>
                {% for person in people %}
                  <a href="{{ ('/people/' + (person | getPersonUniqueKey(collections) | slug) + '/') | url }}" class="entity-link person-link">{{ person }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
              </p>
            {% endif %}
            {% if companies_orgs and companies_orgs.length > 0 %}
              <p><strong>公司/组织:</strong>
                {% for company in companies_orgs %}
                  <a href="{{ ('/companies-orgs/' + (company | getCompanyUniqueKey(collections) | slug) + '/') | url }}" class="entity-link company-link">{{ company }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
              </p>
            {% endif %}
            {% if products_models and products_models.length > 0 %}
              <p><strong>产品/模型:</strong>
                {% for product in products_models %}
                  <a href="{{ ('/products-models/' + (product | getProductUniqueKey(collections) | slug) + '/') | url }}" class="entity-link product-link">{{ product }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
              </p>
            {% endif %}
            {% if media_books and media_books.length > 0 %}
              <p><strong>媒体/书籍:</strong>
                {% for media in media_books %}
                  <a href="{{ ('/media-books/' + (media | getMediaUniqueKey(collections) | slug) + '/') | url }}" class="entity-link media-link">{{ media }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
              </p>
            {% endif %}
          </div>
        </details>
      </div>
    {% endif %}

    {# 关键字部分 - 移到文章正文之后 #}
    {% if tags %}
      <div class="tags-section">
        <p><strong>关键字:</strong>
          {% for tag in tags %}
            {% if tag != "post" and tag != "note" and tag != "视频文稿" %}
              <a class="tag-link" href="{{ ('/tags/' + (tag | slug) + '/') | url }}">{{ tag }}</a>
            {% endif %}
          {% endfor %}
        </p>
      </div>
    {% endif %}

    {# ------------------- 文章末尾元数据结束 ------------------- #}

    {# ------------------- 系列相关文章开始 ------------------- #}
    {% if series and series.trim() != '' %}
      {% set relatedPosts = collections.allItems | filterExcluded %}
      {% set sameSeries = [] %}
      
      {# 找到同一系列的其他文章 #}
      {% for post in relatedPosts %}
        {% if post.data.series and post.data.series.trim() == series.trim() and post.url != page.url %}
          {% set sameSeries = (sameSeries.push(post), sameSeries) %}
        {% endif %}
      {% endfor %}

      {# 如果有同系列的文章，显示相关文章区块 #}
      {% if sameSeries.length > 0 %}
        <div class="related-series">
          <h3>本系列其他文章</h3>
          <p class="series-name">系列：{{ series }}</p>
          <ul class="related-posts-list">
            {% for post in sameSeries | sort(false, false, 'date') %}
              <li class="related-post-item">
                <a href="{{ post.url }}" class="related-post-link">
                  <span class="related-post-title">{{ post.data.title }}</span>
                  {% if post.data.date %}
                    {% if post.data.date.toLocaleDateString %}
                      <span class="related-post-date">{{ post.data.date.toLocaleDateString() }}</span>
                    {% else %}
                      <span class="related-post-date">{{ post.data.date }}</span>
                    {% endif %}
                  {% endif %}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    {% endif %}
    {# ------------------- 系列相关文章结束 ------------------- #}
  </main>

  {# 全局展开/折叠英文原文按钮 #}
  <button class="toggle-all-details-btn" id="toggleAllDetailsBtn" aria-label="展开/折叠所有英文原文">
    <span class="icon">📖</span>
    <span class="btn-text">展开全部原文</span>
  </button>

</div>

<script src="{{ '/js/post.js' | url }}"></script>
<script src="{{ '/js/toggle-details.js' | url }}"></script>